(function(){window.Localisr=window.Localisr||{};var a="(^|\\s)+",b="($|\\s)+",c=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b},d={position:"absolute",left:0,background:"#eee",border:"1px solid #222",padding:"5px",display:"none",zIndex:10},e=function(a,b,c){var e=$("<span>").addClass("converted-value-hover").css(d).text("Original "+c+": "+a),f=$("<span>").text(b).addClass("converted-value").css("position","relative").append(e);return $("<div>").html(f).html()},f,g,h,i,j,k,l,m=function(a,b,c){var d,e;c=c||":";var f=a.indexOf(c);return f===-1?(d=parseInt(a,10),e=0):(d=parseInt(a.substring(0,f),10),e=parseInt(a.substring(f+1,a.length),10)),n(d,e,b)},n=function(a,b,c,d){var e=new Date,f;d?f=!0:(f=!1,d={});var g={year:e.getFullYear(),month:e.getMonth(),dayOfMonth:e.getDate()};$.extend(d,g);var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=h[d.month]+" "+d.dayOfMonth+", "+d.year+" "+a+":"+b+" "+c,j=new Date(i),k=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),l=k.toUTCString(),m=new Date(l.substring(0,l.lastIndexOf(" ")-1)),n=(k-m)/36e5;j.setTime(j.getTime()+n*60*60*1e3);var o=j.toUTCString().substring(0,j.toUTCString().lastIndexOf(" ")-3),p=new Date(o);if(p.toString()==="Invalid Date")return console.log("Unsupported time zone"),null;var q=p.toTimeString(),r=q.substring(0,5)+" "+q.substring(q.length-4,q.length-1);return f&&(r+=", "+p.toDateString()),r},o,p,q=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYR","BZD","CAD","CDF","CHF","CLF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KZT","LAK","LBP","LKR","LRD","LSL","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRO","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","STD","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","VUV","WST","XAF","XCD","XDR","XOF","XPF","YER","ZAR","ZMK","ZWL"],r=["£","€","¥","$"],s=[],t,u="[0-9]+\\.?([0-9]{2})?";for(t=0;t<q.length;t++)s.push(q[t]);for(t=0;t<r.length;t++){var v=r[t];v==="$"&&(v="\\$"),s.push(v)}var w="("+s.join("|")+"){1}",x=w+"\\s*"+u,y=new RegExp(a+x+b,"g"),z=new RegExp(x,"g"),A=new RegExp(w,"g"),B={"£":"GBP",$:"USD","€":"EUR","¥":"JPY"},C=c(B),D=function(a,b){var c;if(q.indexOf(b)!==-1)c=b;else if(r.indexOf(b)!==-1)c=B[b];else throw new Error("Invalid currency type "+b);var d=accounting.unformat(a),e=money.convert(d,{from:c,to:o}),f=accounting.formatMoney(e,p,2);return f},E=function(a){$(a).contents().each(function(a){if(this.nodeType===3){var b=this.textContent,c=b,d=!1,f=b.match(y),g=b.match(A),h,l;if(f&&g){h=b.match(z);for(l=0;l<f.length;l++){if(!f[l]||!g[l])break;d=!0;var n=f[l],o=g[l],p=D(n,o);b=b.replace(h[l],e(n,p,"price"))}}var q=!1,r=b.match(j);if(r){h=b.match(k);var s=b.match(i);for(l=0;l<r.length;l++){if(!r[l])break;q=!0;var t=r[l],u=m(t,s[l]);u!==null&&(b=b.replace(h[l],e(t,u,"time")))}}if(d||q){var v=$("<span>");v.attr("data-original-text",c),v.html(b),$(this).replaceWith(v)}}else this.nodeType===1&&this.nodeName.toLowerCase()!=="iframe"&&E(this)})},F=function(a){$(a).contents().each(function(a){if(this.nodeType===1&&this.nodeName.toLowerCase()!=="iframe"){if(this.nodeName.toLowerCase()==="span"){var b=$(this),c=b.attr("data-original-text");if(c){var d=document.createTextNode(c);$(this).replaceWith(d);return}}F(this)}})},G,H=function(){for(var a=0;a<G.length;a++)if(!G[a])return;p=C[o]||o+" ",l="GMT",money.base="USD",E("body"),$(".converted-value").on("mouseenter",function(){$(this).find(".converted-value-hover").show()}).on("mouseout",function(){$(this).find(".converted-value-hover").hide()}),$(".converted-value-hover").each(function(){var a=$(this);a.css("bottom",-(a.height()+10))})};Localisr.isConverted?(Localisr.isConverted=!1,F("body")):(Localisr.isConverted=!0,G=[!1,!1,!1],chrome.extension.sendMessage({method:"getExchangeRates"},function(a){money.rates=a.data.rates,G[0]=!0,H()}),chrome.extension.sendMessage({method:"getLocalStorage",key:"currency"},function(a){o=a.data||"AED",G[1]=!0,H()}),chrome.extension.sendMessage({method:"getTimezones"},function(c){f=c;var d=[];for(var e in f)d.push(e);g="("+d.join("|")+"){1}",h="[0-9]{1,2}\\s*:\\s*[0-9]{2}\\s*"+g,i=new RegExp(g,"g"),j=new RegExp(a+h+b,"g"),k=new RegExp(h,"g"),G[2]=!0,H()}))})();