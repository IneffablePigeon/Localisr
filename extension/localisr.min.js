(function(){window.Localisr=window.Localisr||{};var a,b=["AED","AFN","ALL","AMD","ANG","AOA","ARS","AUD","AWG","AZN","BAM","BBD","BDT","BGN","BHD","BIF","BMD","BND","BOB","BRL","BSD","BTN","BWP","BYR","BZD","CAD","CDF","CHF","CLF","CLP","CNY","COP","CRC","CUP","CVE","CZK","DJF","DKK","DOP","DZD","EGP","ETB","EUR","FJD","FKP","GBP","GEL","GHS","GIP","GMD","GNF","GTQ","GYD","HKD","HNL","HRK","HTG","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KGS","KHR","KMF","KPW","KRW","KWD","KZT","LAK","LBP","LKR","LRD","LSL","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MNT","MOP","MRO","MUR","MVR","MWK","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PGK","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SBD","SCR","SDG","SEK","SGD","SHP","SLL","SOS","SRD","STD","SVC","SYP","SZL","THB","TJS","TMT","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","USD","UYU","UZS","VEF","VND","VUV","WST","XAF","XCD","XDR","XOF","XPF","YER","ZAR","ZMK","ZWL"],c=["£","€","¥","$"],d=[],e;for(e=0;e<b.length;e++)d.push(b[e]);for(e=0;e<c.length;e++){var f=c[e];f==="$"&&(f="\\$"),d.push(f)}var g="[0-9]+\\.?([0-9]{2})?",h="("+d.join("|")+"){1}",i=h+"\\s*"+g,j="(^|\\s)+",k="($|\\s)+",l=new RegExp(j+i+k,"g"),m=new RegExp(i,"g"),n=new RegExp(h,"g"),o,p,q,r,s,t,u,v,w=function(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[a[c]]=c);return b},x={"£":"GBP",$:"USD","€":"EUR","¥":"JPY"},y=w(x),z=function(a,b,c){var d,e;c=c||":";var f=a.indexOf(c);return f===-1?(d=parseInt(a,10),e=0):(d=parseInt(a.substring(0,f),10),e=parseInt(a.substring(f+1,a.length),10)),A(d,e,b)},A=function(a,b,c,d){var e=new Date,f;d?f=!0:(f=!1,d={});var g={year:e.getFullYear(),month:e.getMonth(),dayOfMonth:e.getDate()};$.extend(d,g);var h=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=h[d.month]+" "+d.dayOfMonth+", "+d.year+" "+a+":"+b+" "+c,j=new Date(i),k=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),l=k.toUTCString(),m=new Date(l.substring(0,l.lastIndexOf(" ")-1)),n=(k-m)/36e5;j.setTime(j.getTime()+n*60*60*1e3);var o=j.toUTCString().substring(0,j.toUTCString().lastIndexOf(" ")-3),p=new Date(o);if(p.toString()==="Invalid Date")return console.log("Unsupported time zone"),null;var q=p.toTimeString(),r=q.substring(0,5)+" "+q.substring(q.length-4,q.length-1);return f&&(r+=", "+p.toDateString()),r},B=function(a,d){var e;if(b.indexOf(d)!==-1)e=d;else if(c.indexOf(d)!==-1)e=x[d];else throw new Error("Invalid currency type "+d);var f=accounting.unformat(a),g=money.convert(f,{from:e,to:t}),h=accounting.formatMoney(g,v,2);return h},C={position:"absolute",left:0,background:"#eee",border:"1px solid #222",padding:"5px",display:"none",zIndex:10},D=function(a,b,c){var d=$("<span>").addClass("converted-value-hover").css(C).text("Original "+c+": "+a),e=$("<span>").text(b).addClass("converted-value").css("position","relative").append(d);return $("<div>").html(e).html()},E=function(a){$(a).contents().each(function(a){if(this.nodeType===3){var b=this.textContent,c=b,d=!1,e=b.match(l),f=b.match(n),g,h;if(e&&f){g=b.match(m);for(h=0;h<e.length;h++){if(!e[h]||!f[h])break;d=!0;var i=e[h],j=f[h],k=B(i,j);b=b.replace(g[h],D(i,k,"price"))}}var o=!1,p=b.match(r);if(p){g=b.match(s);var t=b.match(q);for(h=0;h<p.length;h++){if(!p[h])break;o=!0;var u=p[h],v=z(u,t[h]);v!==null&&(b=b.replace(g[h],D(u,v,"time")))}}if(d||o){var w=$("<span>");w.attr("data-original-text",c),w.html(b),$(this).replaceWith(w)}}else this.nodeType===1&&this.nodeName.toLowerCase()!=="iframe"&&E(this)})},F=function(a){$(a).contents().each(function(a){if(this.nodeType===1&&this.nodeName.toLowerCase()!=="iframe"){if(this.nodeName.toLowerCase()==="span"){var b=$(this),c=b.attr("data-original-text");if(c){var d=document.createTextNode(c);$(this).replaceWith(d);return}}F(this)}})},G,H=function(){for(var a=0;a<G.length;a++)if(!G[a])return;v=y[t]||t+" ",u="GMT",money.base="USD",E("body"),$(".converted-value").on("mouseenter",function(){$(this).find(".converted-value-hover").show()}).on("mouseout",function(){$(this).find(".converted-value-hover").hide()}),$(".converted-value-hover").each(function(){var a=$(this);a.css("bottom",-(a.height()+10))})};Localisr.isConverted?(Localisr.isConverted=!1,F("body")):(Localisr.isConverted=!0,G=[!1,!1,!1],chrome.extension.sendMessage({method:"getExchangeRates"},function(a){money.rates=a.data.rates,G[0]=!0,H()}),chrome.extension.sendMessage({method:"getLocalStorage",key:"currency"},function(a){t=a.data||"AED",G[1]=!0,H()}),chrome.extension.sendMessage({method:"getTimezones"},function(b){a=b;var c=[];for(var d in a)c.push(d);o="("+c.join("|")+"){1}",p="[0-9]{1,2}\\s*:\\s*[0-9]{2}\\s*"+o,q=new RegExp(o,"g"),r=new RegExp(j+p+k,"g"),s=new RegExp(p,"g"),G[2]=!0,H()}))})();